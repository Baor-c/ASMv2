@model FastFoodApp.ViewModels.ProfileViewModel
@{
    ViewData["Title"] = "Hồ sơ của tôi";

    string FormatPrice(decimal price)
    {
        return price.ToString("N0") + "đ";
    }
}

<div class="min-h-screen bg-gray-50 py-8">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
        <!-- Header -->
        <div class="mb-8 animate-fade-in">
            <h1 class="text-3xl font-bold text-gray-900 mb-2">Thông tin cá nhân</h1>
            <p class="text-gray-600">Quản lý thông tin và theo dõi cấp thành viên của bạn.</p>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Left Column: Profile Info & Stats -->
            <div class="lg:col-span-2 space-y-6">
                <!-- Basic Info Card -->
                <div class="bg-white rounded-xl shadow-lg p-6 animate-slide-up">
                    <h2 class="text-xl font-semibold mb-6">Thông tin cơ bản</h2>
                    <form asp-action="Profile" method="post" class="space-y-6">
                        @Html.AntiForgeryToken()
                        <input type="hidden" asp-for="MaNguoiDung" />
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label asp-for="HoTen" class="block text-sm font-medium text-gray-700 mb-1"><i data-lucide="user" class="inline h-4 w-4 mr-1"></i>Họ và tên</label>
                                <input asp-for="HoTen" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500" />
                                <span asp-validation-for="HoTen" class="text-red-500 text-sm"></span>
                            </div>
                            <div>
                                <label asp-for="SoDienThoai" class="block text-sm font-medium text-gray-700 mb-1"><i data-lucide="phone" class="inline h-4 w-4 mr-1"></i>Số điện thoại</label>
                                <input asp-for="SoDienThoai" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500" />
                                <span asp-validation-for="SoDienThoai" class="text-red-500 text-sm"></span>
                            </div>
                        </div>
                        <div class="flex justify-end">
                            <button type="submit" class="bg-red-600 text-white px-6 py-2 rounded-lg font-semibold hover:bg-red-700 transition-colors flex items-center space-x-2">
                                <i data-lucide="save" class="h-4 w-4"></i>
                                <span>Lưu thay đổi</span>
                            </button>
                        </div>
                    </form>
                </div>

                <!-- Address Management Section -->
                <div class="bg-white rounded-xl shadow-lg p-6 animate-slide-up" style="animation-delay: 200ms;">
                    <h3 class="text-xl font-bold text-gray-900 mb-4">Sổ địa chỉ</h3>

                    <div class="space-y-4 mb-6">
                        @if (Model.Addresses != null && Model.Addresses.Any())
                        {
                            @foreach (var address in Model.Addresses)
                            {
                                        <div class="border rounded-lg p-4 flex justify-between items-start">
                                            <div>
                                                <p class="font-semibold">@address.TenNguoiNhan</p>
                                                <p class="text-sm text-gray-600">@address.DiaChiCuThe</p>
                                                <p class="text-sm text-gray-600">@address.SoDienThoai</p>
                                            </div>
                                            <form asp-action="DeleteAddress" asp-route-id="@address.MaDiaChi" method="post">
                                                <button type="submit" class="text-red-500 hover:text-red-700 text-sm p-1">
                                                    <i data-lucide="trash-2" class="h-4 w-4"></i>
                                                </button>
                                            </form>
                                        </div>
                            }
                        }
                        else
                        {
                                <p class="text-sm text-gray-500">Bạn chưa có địa chỉ nào được lưu.</p>
                        }
                    </div>

                    <h4 class="font-semibold mb-2">Thêm địa chỉ mới</h4>
                    <form asp-action="AddAddress" method="post" class="space-y-4">
                        <input type="text" asp-for="NewAddress.TenNguoiNhan" placeholder="Họ và tên người nhận" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500" />
                        <input type="tel" asp-for="NewAddress.SoDienThoai" placeholder="Số điện thoại" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500" />

                        <div>
                            <textarea asp-for="NewAddress.DiaChiCuThe" id="new-address-input" placeholder="Địa chỉ cụ thể (số nhà, đường, phường/xã...)" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500" rows="3"></textarea>
                            <button type="button" id="get-location-btn" class="mt-2 w-full bg-red-100 text-red-700 py-2 rounded-lg font-semibold hover:bg-red-200 transition-colors flex items-center justify-center space-x-2">
                                <i data-lucide="map-pin" class="h-4 w-4"></i>
                                <span>Sử dụng vị trí hiện tại của tôi</span>
                            </button>
                        </div>

                        <button type="submit" class="w-full bg-red-600 text-white py-2 rounded-lg font-semibold hover:bg-red-700 transition-colors">Thêm địa chỉ</button>
                    </form>
                </div>
            </div>

            <!-- Right Column: Membership & Actions -->
            <div class="lg:col-span-1">
                 <div class="bg-white rounded-xl shadow-lg p-6 sticky top-8 animate-slide-up" style="animation-delay: 200ms;">
                    <h2 class="text-xl font-semibold mb-4 flex items-center"><i data-lucide="crown" class="h-5 w-5 mr-2 text-yellow-500"></i>Cấp thành viên</h2>
                    <div class="p-4 rounded-lg mb-4 bg-red-50 border border-red-200">
                        <div class="flex items-center justify-between mb-2">
                            <span class="font-bold text-lg text-red-800">@Model.CurrentMembership.TenCap</span>
                        </div>
                        <div class="text-sm text-red-700 mb-2">Giảm giá: @Model.CurrentMembership.PhanTramGiamGia%</div>
                    </div>
                    @if (Model.NextMembership != null)
                    {
                            <div class="mb-6">
                                <div class="flex items-center justify-between mb-2">
                                    <span class="text-sm font-medium">Tiến độ lên @Model.NextMembership.TenCap</span>
                                    <span class="text-sm text-gray-600">@Math.Round(Model.ProgressToNextLevel)%</span>
                                </div>
                                <div class="w-full bg-gray-200 rounded-full h-2">
                                    <div class="bg-gradient-to-r from-red-500 to-yellow-500 h-2 rounded-full" style="width: @(Model.ProgressToNextLevel)%"></div>
                                </div>
                            </div>
                    }
                    <div class="space-y-3">
                        <a asp-controller="Order" asp-action="Index" class="w-full bg-red-600 text-white py-2 rounded-lg font-semibold hover:bg-red-700 transition-colors flex items-center justify-center space-x-2">
                            <i data-lucide="history" class="h-4 w-4"></i>
                            <span>Xem lịch sử đơn hàng</span>
                        </a>
                        <form asp-controller="Account" asp-action="Logout" method="post">
                             <button type="submit" class="w-full border border-gray-300 text-gray-700 py-2 rounded-lg font-semibold hover:bg-gray-50 transition-colors flex items-center justify-center space-x-2">
                                <i data-lucide="log-out" class="h-4 w-4"></i>
                                <span>Đăng xuất</span>
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section Scripts {
        <script>
            lucide.createIcons();
        </script>
}
